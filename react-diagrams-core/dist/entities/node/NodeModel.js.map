{"version":3,"file":"NodeModel.js","sourceRoot":"","sources":["../../../src/entities/node/NodeModel.ts"],"names":[],"mappings":"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","sourcesContent":["import _forEach from 'lodash/forEach';\r\nimport _map from 'lodash/map';\r\nimport _values from 'lodash/values';\r\nimport { DiagramModel } from '../../models/DiagramModel';\r\nimport { PortModel } from '../port/PortModel';\r\nimport { LinkModel } from '../link/LinkModel';\r\nimport { Point, Rectangle } from '@projectstorm/geometry';\r\nimport {\r\n\tBaseEntityEvent,\r\n\tBaseModelListener,\r\n\tBasePositionModel,\r\n\tBasePositionModelGenerics,\r\n\tDeserializeEvent\r\n} from '@projectstorm/react-canvas-core';\r\nimport { DiagramEngine } from '../../DiagramEngine';\r\n\r\nexport interface NodeModelListener extends BaseModelListener {\r\n\tpositionChanged?(event: BaseEntityEvent<NodeModel>): void;\r\n}\r\n\r\nexport interface NodeModelGenerics extends BasePositionModelGenerics {\r\n\tLISTENER: NodeModelListener;\r\n\tPARENT: DiagramModel;\r\n}\r\n\r\nexport class NodeModel<G extends NodeModelGenerics = NodeModelGenerics> extends BasePositionModel<G> {\r\n\tprotected ports: { [s: string]: PortModel };\r\n\r\n\t// calculated post rendering so routing can be done correctly\r\n\twidth: number;\r\n\theight: number;\r\n\tisWorktable: boolean;\r\n\r\n\tconstructor(options: G['OPTIONS']) {\r\n\t\tsuper(options);\r\n\t\tthis.ports = {};\r\n\t\tthis.width = 0;\r\n\t\tthis.height = 0;\r\n\t\tthis.isWorktable = false;\r\n\t}\r\n\r\n\tgetBoundingBox(): Rectangle {\r\n\t\treturn Rectangle.fromPointAndSize(this.getPosition(), this.width, this.height);\r\n\t}\r\n\r\n\tgetIsWorktable(): boolean {\r\n\t\treturn this.isWorktable;\r\n\t}\r\n\tsetIsWorktable(value: boolean ): void {\r\n\t\t this.isWorktable = value;\r\n\t}\r\n\r\n\tsetPosition(point: Point): void;\r\n\tsetPosition(x: number, y: number): void;\r\n\tsetPosition(x: number | Point, y?: number): void {\r\n\t\tconst old = this.position;\r\n\r\n\t\tif (x instanceof Point) {\r\n\t\t\tsuper.setPosition(x);\r\n\t\t} else {\r\n\t\t\tsuper.setPosition(x, y);\r\n\t\t}\r\n\r\n\t\t//also update the port co-ordinates (for make glorious speed)\r\n\t\t_forEach(this.ports, (port) => {\r\n\t\t\tport.setPosition(port.getX() + this.position.x - old.x, port.getY() + this.position.y - old.y);\r\n\t\t});\r\n\t}\r\n\r\n\tdeserialize(event: DeserializeEvent<this>) {\r\n\t\tsuper.deserialize(event);\r\n\r\n\t\t//deserialize ports\r\n\t\t_forEach(event.data.ports, (port: any) => {\r\n\t\t\tlet portOb = (event.engine as DiagramEngine).getFactoryForPort(port.type).generateModel({});\r\n\t\t\tportOb.deserialize({\r\n\t\t\t\t...event,\r\n\t\t\t\tdata: port\r\n\t\t\t});\r\n\t\t\t// the links need these\r\n\t\t\tevent.registerModel(portOb);\r\n\t\t\tthis.addPort(portOb);\r\n\t\t});\r\n\t}\r\n\r\n\tserialize() {\r\n\t\treturn {\r\n\t\t\t...super.serialize(),\r\n\t\t\tports: _map(this.ports, (port) => {\r\n\t\t\t\treturn port.serialize();\r\n\t\t\t})\r\n\t\t};\r\n\t}\r\n\r\n\tdoClone(lookupTable = {}, clone) {\r\n\t\t// also clone the ports\r\n\t\tclone.ports = {};\r\n\t\t_forEach(this.ports, (port) => {\r\n\t\t\tclone.addPort(port.clone(lookupTable));\r\n\t\t});\r\n\t}\r\n\r\n\tremove() {\r\n\t\tsuper.remove();\r\n\t\t_forEach(this.ports, (port) => {\r\n\t\t\t_forEach(port.getLinks(), (link) => {\r\n\t\t\t\tlink.remove();\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\tgetPortFromID(id): PortModel | null {\r\n\t\tfor (var i in this.ports) {\r\n\t\t\tif (this.ports[i].getID() === id) {\r\n\t\t\t\treturn this.ports[i];\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\tgetLink(id: string): LinkModel {\r\n\t\tfor (let portID in this.ports) {\r\n\t\t\tconst links = this.ports[portID].getLinks();\r\n\t\t\tif (links[id]) {\r\n\t\t\t\treturn links[id];\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tgetPort(name: string): PortModel | null {\r\n\t\treturn this.ports[name];\r\n\t}\r\n\r\n\tgetPorts(): { [s: string]: PortModel } {\r\n\t\treturn this.ports;\r\n\t}\r\n\r\n\tremovePort(port: PortModel) {\r\n\t\t// clear the port from the links\r\n\t\tfor (let link of _values(port.getLinks())) {\r\n\t\t\tlink.clearPort(port);\r\n\t\t}\r\n\t\t//clear the parent node reference\r\n\t\tif (this.ports[port.getName()]) {\r\n\t\t\tthis.ports[port.getName()].setParent(null);\r\n\t\t\tdelete this.ports[port.getName()];\r\n\t\t}\r\n\t}\r\n\r\n\taddPort(port: PortModel): PortModel {\r\n\t\tport.setParent(this);\r\n\t\tthis.ports[port.getName()] = port;\r\n\t\treturn port;\r\n\t}\r\n\r\n\tupdateDimensions({ width, height }: { width: number; height: number }) {\r\n\t\tthis.width = width;\r\n\t\tthis.height = height;\r\n\t}\r\n}\r\n"]}
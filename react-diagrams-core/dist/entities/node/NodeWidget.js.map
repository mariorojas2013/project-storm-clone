{"version":3,"file":"NodeWidget.js","sourceRoot":"","sources":["../../../src/entities/node/NodeWidget.tsx"],"names":[],"mappings":"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","sourcesContent":["import * as React from 'react';\r\nimport _forEach from 'lodash/forEach';\r\nimport { DiagramEngine } from '../../DiagramEngine';\r\nimport { NodeModel } from './NodeModel';\r\nimport { BaseEntityEvent, BaseModel, ListenerHandle, PeformanceWidget } from '@projectstorm/react-canvas-core';\r\nimport styled from '@emotion/styled';\r\nimport ResizeObserver from 'resize-observer-polyfill';\r\n\r\nexport interface NodeProps {\r\n\tnode: NodeModel;\r\n\tchildren?: any;\r\n\tdiagramEngine: DiagramEngine;\r\n}\r\n\r\nnamespace S {\r\n\texport const Node = styled.div`\r\n\t\tposition: absolute;\r\n\t\t-webkit-touch-callout: none; /* iOS Safari */\r\n\t\t-webkit-user-select: none; /* Chrome/Safari/Opera */\r\n\t\tuser-select: none;\r\n\t\tcursor: move;\r\n\t\tpointer-events: all;\r\n\t`;\r\n}\r\n\r\nexport class NodeWidget extends React.Component<NodeProps> {\r\n\tob: any;\r\n\tref: React.RefObject<HTMLDivElement>;\r\n\tlistener: ListenerHandle;\r\n\r\n\tconstructor(props: NodeProps) {\r\n\t\tsuper(props);\r\n\t\tthis.ref = React.createRef();\r\n\t}\r\n\r\n\tcomponentWillUnmount(): void {\r\n\t\tthis.ob.disconnect();\r\n\t\tthis.ob = null;\r\n\r\n\t\tthis.listener?.deregister();\r\n\t\tthis.listener = null;\r\n\t}\r\n\r\n\tcomponentDidUpdate(prevProps: Readonly<NodeProps>, prevState: Readonly<any>, snapshot?: any): void {\r\n\t\tif (this.listener && this.props.node !== prevProps.node) {\r\n\t\t\tthis.listener.deregister();\r\n\t\t\tthis.installSelectionListener();\r\n\t\t}\r\n\t}\r\n\r\n\tinstallSelectionListener() {\r\n\t\tthis.listener = this.props.node.registerListener({\r\n\t\t\tselectionChanged: (event: BaseEntityEvent<BaseModel> & { isSelected: boolean }) => {\r\n\t\t\t\tthis.forceUpdate();\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tupdateSize(width: number, height: number) {\r\n\t\tthis.props.node.updateDimensions({ width, height });\r\n\r\n\t\t//now mark the links as dirty\r\n\t\ttry {\r\n\t\t\t_forEach(this.props.node.getPorts(), (port) => {\r\n\t\t\t\tport.updateCoords(this.props.diagramEngine.getPortCoords(port));\r\n\t\t\t});\r\n\t\t} catch (ex) {}\r\n\t}\r\n\r\n\tcomponentDidMount(): void {\r\n\t\t// @ts-ignore\r\n\t\tthis.ob = new ResizeObserver((entities) => {\r\n\t\t\tconst bounds = entities[0].contentRect;\r\n\t\t\tthis.updateSize(bounds.width, bounds.height);\r\n\t\t});\r\n\r\n\t\tconst b = this.ref.current.getBoundingClientRect();\r\n\t\tthis.updateSize(b.width, b.height);\r\n\t\tthis.ob.observe(this.ref.current);\r\n\t\tthis.installSelectionListener();\r\n\t}\r\n\r\n\trender() {\r\n\t\treturn (\r\n\t\t\t<PeformanceWidget model={this.props.node} serialized={this.props.node.serialize()}>\r\n\t\t\t\t{() => {\r\n\t\t\t\t\treturn (\r\n\t\t\t\t\t\t<S.Node\r\n\t\t\t\t\t\t\tclassName=\"node\"\r\n\t\t\t\t\t\t\tref={this.ref}\r\n\t\t\t\t\t\t\tdata-nodeid={this.props.node.getID()}\r\n\t\t\t\t\t\t\tstyle={{\r\n\t\t\t\t\t\t\t\ttop: this.props.node.getY(),\r\n\t\t\t\t\t\t\t\tleft: this.props.node.getX()\r\n\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t{this.props.diagramEngine.generateWidgetForNode(this.props.node)}\r\n\t\t\t\t\t\t</S.Node>\r\n\t\t\t\t\t);\r\n\t\t\t\t}}\r\n\t\t\t</PeformanceWidget>\r\n\t\t);\r\n\t}\r\n}\r\n"]}
{"version":3,"file":"AbstractDisplacementState.js","sourceRoot":"","sources":["../../src/core-state/AbstractDisplacementState.ts"],"names":[],"mappings":"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","sourcesContent":["import { State, StateOptions } from './State';\r\nimport { Action, ActionEvent, InputType } from '../core-actions/Action';\r\nimport { CanvasEngine } from '../CanvasEngine';\r\n\r\nexport interface AbstractDisplacementStateEvent {\r\n\tdisplacementX: number;\r\n\tdisplacementY: number;\r\n\tvirtualDisplacementX: number;\r\n\tvirtualDisplacementY: number;\r\n\tevent: React.MouseEvent | React.TouchEvent;\r\n}\r\n\r\nexport abstract class AbstractDisplacementState<E extends CanvasEngine = CanvasEngine> extends State<E> {\r\n\tinitialX: number;\r\n\tinitialY: number;\r\n\tinitialXRelative: number;\r\n\tinitialYRelative: number;\r\n\r\n\tconstructor(options: StateOptions) {\r\n\t\tsuper(options);\r\n\t\tthis.registerAction(\r\n\t\t\tnew Action({\r\n\t\t\t\ttype: InputType.MOUSE_DOWN,\r\n\t\t\t\tfire: (actionEvent: ActionEvent<React.MouseEvent>) => {\r\n\t\t\t\t\tconst { clientX, clientY } = actionEvent.event;\r\n\t\t\t\t\tthis.handleMoveStart(clientX, clientY);\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t);\r\n\t\tthis.registerAction(\r\n\t\t\tnew Action({\r\n\t\t\t\ttype: InputType.MOUSE_MOVE,\r\n\t\t\t\tfire: (actionEvent: ActionEvent<React.MouseEvent>) => {\r\n\t\t\t\t\tconst { event } = actionEvent;\r\n\r\n\t\t\t\t\tif (event.buttons === 0) {\r\n\t\t\t\t\t\t// If buttons is 0, it means the mouse is not down, the user may have released it\r\n\t\t\t\t\t\t// outside of the canvas, then we eject the state\r\n\t\t\t\t\t\tthis.eject();\r\n\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tconst { clientX, clientY } = event;\r\n\t\t\t\t\tthis.handleMove(clientX, clientY, event);\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t);\r\n\t\tthis.registerAction(\r\n\t\t\tnew Action({\r\n\t\t\t\ttype: InputType.MOUSE_UP,\r\n\t\t\t\tfire: () => this.handleMoveEnd()\r\n\t\t\t})\r\n\t\t);\r\n\r\n\t\tthis.registerAction(\r\n\t\t\tnew Action({\r\n\t\t\t\ttype: InputType.TOUCH_START,\r\n\t\t\t\tfire: (actionEvent: ActionEvent<React.TouchEvent>) => {\r\n\t\t\t\t\tconst { clientX, clientY } = actionEvent.event.touches[0];\r\n\t\t\t\t\tthis.handleMoveStart(clientX, clientY);\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t);\r\n\t\tthis.registerAction(\r\n\t\t\tnew Action({\r\n\t\t\t\ttype: InputType.TOUCH_MOVE,\r\n\t\t\t\tfire: (actionEvent: ActionEvent<React.TouchEvent>) => {\r\n\t\t\t\t\tconst { event } = actionEvent;\r\n\t\t\t\t\tconst { clientX, clientY } = event.touches[0];\r\n\t\t\t\t\tthis.handleMove(clientX, clientY, event);\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t);\r\n\t\tthis.registerAction(\r\n\t\t\tnew Action({\r\n\t\t\t\ttype: InputType.TOUCH_END,\r\n\t\t\t\tfire: () => this.handleMoveEnd()\r\n\t\t\t})\r\n\t\t);\r\n\t}\r\n\r\n\tprotected handleMoveStart(x: number, y: number): void {\r\n\t\tthis.initialX = x;\r\n\t\tthis.initialY = y;\r\n\t\tconst rel = this.engine.getRelativePoint(x, y);\r\n\t\tthis.initialXRelative = rel.x;\r\n\t\tthis.initialYRelative = rel.y;\r\n\t}\r\n\r\n\tprotected handleMove(x: number, y: number, event: React.MouseEvent | React.TouchEvent): void {\r\n\t\tthis.fireMouseMoved({\r\n\t\t\tdisplacementX: x - this.initialX,\r\n\t\t\tdisplacementY: y - this.initialY,\r\n\t\t\tvirtualDisplacementX: (x - this.initialX) / (this.engine.getModel().getZoomLevel() / 100.0),\r\n\t\t\tvirtualDisplacementY: (y - this.initialY) / (this.engine.getModel().getZoomLevel() / 100.0),\r\n\t\t\tevent\r\n\t\t});\r\n\t}\r\n\r\n\tprotected handleMoveEnd(): void {\r\n\t\tthis.eject();\r\n\t}\r\n\r\n\tabstract fireMouseMoved(event: AbstractDisplacementStateEvent);\r\n}\r\n"]}
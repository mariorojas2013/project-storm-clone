{"version":3,"file":"MoveItemsState.js","sourceRoot":"","sources":["../../src/states/MoveItemsState.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,yBAAyB,EAAkC,MAAM,yCAAyC,CAAC;AAEpH,OAAO,EAAE,MAAM,EAAe,SAAS,EAAE,MAAM,wBAAwB,CAAC;AACxE,OAAO,EAAE,iBAAiB,EAAE,MAAM,kCAAkC,CAAC;AAIrE,MAAM,OAAO,cAAsD,SAAQ,yBAA4B;IAQtG;QACC,KAAK,CAAC;YACL,IAAI,EAAE,YAAY;SAClB,CAAC,CAAC;QACH,IAAI,CAAC,cAAc,CAClB,IAAI,MAAM,CAAC;YACV,IAAI,EAAE,SAAS,CAAC,UAAU;YAC1B,IAAI,EAAE,CAAC,KAAoC,EAAE,EAAE;gBAC9C,MAAM,OAAO,GAAG,IAAI,CAAC,MAAM,CAAC,iBAAiB,EAAE,CAAC,gBAAgB,CAAC,KAAK,CAAC,CAAC;gBACxE,IAAI,CAAC,OAAO,EAAE,CAAC;oBACd,OAAO;gBACR,CAAC;gBACD,IAAI,CAAC,OAAO,CAAC,UAAU,EAAE,EAAE,CAAC;oBAC3B,IAAI,CAAC,MAAM,CAAC,QAAQ,EAAE,CAAC,cAAc,EAAE,CAAC;gBACzC,CAAC;gBACD,OAAO,CAAC,WAAW,CAAC,IAAI,CAAC,CAAC;gBAC1B,IAAI,CAAC,MAAM,CAAC,aAAa,EAAE,CAAC;YAC7B,CAAC;SACD,CAAC,CACF,CAAC;IACH,CAAC;IAED,SAAS,CAAC,QAAe;QACxB,KAAK,CAAC,SAAS,CAAC,QAAQ,CAAC,CAAC;QAC1B,IAAI,CAAC,gBAAgB,GAAG,EAAE,CAAC;IAC5B,CAAC;IAED,cAAc,CAAC,KAAqC;QACnD,MAAM,KAAK,GAAG,IAAI,CAAC,MAAM,CAAC,QAAQ,EAAE,CAAC,mBAAmB,EAAE,CAAC;QAC3D,MAAM,KAAK,GAAG,IAAI,CAAC,MAAM,CAAC,QAAQ,EAAE,CAAC;QACrC,KAAK,IAAI,IAAI,IAAI,KAAK,EAAE,CAAC;YACxB,IAAI,IAAI,YAAY,iBAAiB,EAAE,CAAC;gBACvC,IAAI,IAAI,CAAC,QAAQ,EAAE,EAAE,CAAC;oBACrB,SAAS;gBACV,CAAC;gBACD,IAAI,CAAC,IAAI,CAAC,gBAAgB,CAAC,IAAI,CAAC,KAAK,EAAE,CAAC,EAAE,CAAC;oBAC1C,IAAI,CAAC,gBAAgB,CAAC,IAAI,CAAC,KAAK,EAAE,CAAC,GAAG;wBACrC,KAAK,EAAE,IAAI,CAAC,WAAW,EAAE;wBACzB,IAAI,EAAE,IAAI;qBACV,CAAC;gBACH,CAAC;gBAED,MAAM,GAAG,GAAG,IAAI,CAAC,gBAAgB,CAAC,IAAI,CAAC,KAAK,EAAE,CAAC,CAAC,KAAK,CAAC;gBACtD,IAAI,CAAC,WAAW,CACf,KAAK,CAAC,eAAe,CAAC,GAAG,CAAC,CAAC,GAAG,KAAK,CAAC,oBAAoB,CAAC,EACzD,KAAK,CAAC,eAAe,CAAC,GAAG,CAAC,CAAC,GAAG,KAAK,CAAC,oBAAoB,CAAC,CACzD,CAAC;YACH,CAAC;QACF,CAAC;QACD,IAAI,CAAC,MAAM,CAAC,aAAa,EAAE,CAAC;IAC7B,CAAC;CACD","sourcesContent":["import { AbstractDisplacementState, AbstractDisplacementStateEvent } from '../core-state/AbstractDisplacementState';\r\nimport { State } from '../core-state/State';\r\nimport { Action, ActionEvent, InputType } from '../core-actions/Action';\r\nimport { BasePositionModel } from '../core-models/BasePositionModel';\r\nimport { Point } from '@projectstorm/geometry';\r\nimport { CanvasEngine } from '../CanvasEngine';\r\n\r\nexport class MoveItemsState<E extends CanvasEngine = CanvasEngine> extends AbstractDisplacementState<E> {\r\n\tinitialPositions: {\r\n\t\t[id: string]: {\r\n\t\t\tpoint: Point;\r\n\t\t\titem: BasePositionModel;\r\n\t\t};\r\n\t};\r\n\r\n\tconstructor() {\r\n\t\tsuper({\r\n\t\t\tname: 'move-items'\r\n\t\t});\r\n\t\tthis.registerAction(\r\n\t\t\tnew Action({\r\n\t\t\t\ttype: InputType.MOUSE_DOWN,\r\n\t\t\t\tfire: (event: ActionEvent<React.MouseEvent>) => {\r\n\t\t\t\t\tconst element = this.engine.getActionEventBus().getModelForEvent(event);\r\n\t\t\t\t\tif (!element) {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (!element.isSelected()) {\r\n\t\t\t\t\t\tthis.engine.getModel().clearSelection();\r\n\t\t\t\t\t}\r\n\t\t\t\t\telement.setSelected(true);\r\n\t\t\t\t\tthis.engine.repaintCanvas();\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t);\r\n\t}\r\n\r\n\tactivated(previous: State) {\r\n\t\tsuper.activated(previous);\r\n\t\tthis.initialPositions = {};\r\n\t}\r\n\r\n\tfireMouseMoved(event: AbstractDisplacementStateEvent) {\r\n\t\tconst items = this.engine.getModel().getSelectedEntities();\r\n\t\tconst model = this.engine.getModel();\r\n\t\tfor (let item of items) {\r\n\t\t\tif (item instanceof BasePositionModel) {\r\n\t\t\t\tif (item.isLocked()) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\tif (!this.initialPositions[item.getID()]) {\r\n\t\t\t\t\tthis.initialPositions[item.getID()] = {\r\n\t\t\t\t\t\tpoint: item.getPosition(),\r\n\t\t\t\t\t\titem: item\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconst pos = this.initialPositions[item.getID()].point;\r\n\t\t\t\titem.setPosition(\r\n\t\t\t\t\tmodel.getGridPosition(pos.x + event.virtualDisplacementX),\r\n\t\t\t\t\tmodel.getGridPosition(pos.y + event.virtualDisplacementY)\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.engine.repaintCanvas();\r\n\t}\r\n}\r\n"]}
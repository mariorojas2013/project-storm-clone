{"version":3,"file":"SelectionBoxState.js","sourceRoot":"","sources":["../../src/states/SelectionBoxState.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,yBAAyB,EAAkC,MAAM,yCAAyC,CAAC;AAEpH,OAAO,EAAE,mBAAmB,EAAE,MAAM,2CAA2C,CAAC;AAChF,OAAO,EAAS,SAAS,EAAE,MAAM,wBAAwB,CAAC;AAc1D,MAAM,OAAO,iBAAyD,SAAQ,yBAA4B;IAGzG;QACC,KAAK,CAAC;YACL,IAAI,EAAE,eAAe;SACrB,CAAC,CAAC;IACJ,CAAC;IAED,SAAS,CAAC,QAAe;QACxB,KAAK,CAAC,SAAS,CAAC,QAAQ,CAAC,CAAC;QAC1B,IAAI,CAAC,KAAK,GAAG,IAAI,mBAAmB,EAAE,CAAC;QACvC,IAAI,CAAC,MAAM,CAAC,QAAQ,EAAE,CAAC,QAAQ,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;IAC7C,CAAC;IAED,WAAW,CAAC,IAAW;QACtB,KAAK,CAAC,WAAW,CAAC,IAAI,CAAC,CAAC;QACxB,IAAI,CAAC,KAAK,CAAC,MAAM,EAAE,CAAC;QACpB,IAAI,CAAC,MAAM,CAAC,aAAa,EAAE,CAAC;IAC7B,CAAC;IAED,gBAAgB,CAAC,KAAqC;QACrD,IAAI,GAAU,CAAC;QAEf,IAAI,SAAS,IAAI,KAAK,CAAC,KAAK,EAAE,CAAC;YAC9B,MAAM,KAAK,GAAG,KAAK,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC;YACrC,GAAG,GAAG,IAAI,CAAC,MAAM,CAAC,gBAAgB,CAAC,KAAK,CAAC,OAAO,EAAE,KAAK,CAAC,OAAO,CAAC,CAAC;QAClE,CAAC;aAAM,CAAC;YACP,GAAG,GAAG,IAAI,CAAC,MAAM,CAAC,gBAAgB,CAAC,KAAK,CAAC,KAAK,CAAC,OAAO,EAAE,KAAK,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC;QAC9E,CAAC;QAED,OAAO;YACN,IAAI,EAAE,GAAG,CAAC,CAAC,GAAG,IAAI,CAAC,gBAAgB,CAAC,CAAC,CAAC,IAAI,CAAC,gBAAgB,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC;YACnE,GAAG,EAAE,GAAG,CAAC,CAAC,GAAG,IAAI,CAAC,gBAAgB,CAAC,CAAC,CAAC,IAAI,CAAC,gBAAgB,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC;YAClE,KAAK,EAAE,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC,GAAG,IAAI,CAAC,gBAAgB,CAAC;YAC9C,MAAM,EAAE,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC,GAAG,IAAI,CAAC,gBAAgB,CAAC;YAC/C,KAAK,EAAE,GAAG,CAAC,CAAC,GAAG,IAAI,CAAC,gBAAgB,CAAC,CAAC,CAAC,IAAI,CAAC,gBAAgB,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC;YACpE,MAAM,EAAE,GAAG,CAAC,CAAC,GAAG,IAAI,CAAC,gBAAgB,CAAC,CAAC,CAAC,IAAI,CAAC,gBAAgB,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC;SACrE,CAAC;IACH,CAAC;IAED,cAAc,CAAC,KAAqC;QACnD,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,IAAI,CAAC,gBAAgB,CAAC,KAAK,CAAC,CAAC,CAAC;QAEhD,MAAM,QAAQ,GAAG,IAAI,CAAC,MAAM,CAAC,qBAAqB,CAAC;YAClD,OAAO,EAAE,IAAI,CAAC,QAAQ;YACtB,OAAO,EAAE,IAAI,CAAC,QAAQ;SACtB,CAAC,CAAC;QACH,IAAI,KAAK,CAAC,oBAAoB,GAAG,CAAC,EAAE,CAAC;YACpC,QAAQ,CAAC,CAAC,IAAI,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC,oBAAoB,CAAC,CAAC;QACpD,CAAC;QACD,IAAI,KAAK,CAAC,oBAAoB,GAAG,CAAC,EAAE,CAAC;YACpC,QAAQ,CAAC,CAAC,IAAI,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC,oBAAoB,CAAC,CAAC;QACpD,CAAC;QACD,MAAM,IAAI,GAAG,SAAS,CAAC,gBAAgB,CACtC,QAAQ,EACR,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC,oBAAoB,CAAC,EACpC,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC,oBAAoB,CAAC,CACpC,CAAC;QAEF,KAAK,IAAI,KAAK,IAAI,IAAI,CAAC,MAAM,CAAC,QAAQ,EAAE,CAAC,oBAAoB,EAAE,EAAE,CAAC;YACjE,IAAK,KAA2C,CAAC,cAAc,EAAE,CAAC;gBACjE,MAAM,MAAM,GAAI,KAA2C,CAAC,cAAc,EAAE,CAAC;gBAC7E,IAAI,IAAI,CAAC,aAAa,CAAC,MAAM,CAAC,UAAU,EAAE,CAAC,IAAI,IAAI,CAAC,aAAa,CAAC,MAAM,CAAC,cAAc,EAAE,CAAC,EAAE,CAAC;oBAC5F,KAAK,CAAC,WAAW,CAAC,IAAI,CAAC,CAAC;gBACzB,CAAC;qBAAM,CAAC;oBACP,KAAK,CAAC,WAAW,CAAC,KAAK,CAAC,CAAC;gBAC1B,CAAC;YACF,CAAC;QACF,CAAC;QAED,IAAI,CAAC,MAAM,CAAC,aAAa,EAAE,CAAC;IAC7B,CAAC;CACD","sourcesContent":["import { AbstractDisplacementState, AbstractDisplacementStateEvent } from '../core-state/AbstractDisplacementState';\r\nimport { State } from '../core-state/State';\r\nimport { SelectionLayerModel } from '../entities/selection/SelectionLayerModel';\r\nimport { Point, Rectangle } from '@projectstorm/geometry';\r\nimport { BasePositionModel } from '../core-models/BasePositionModel';\r\nimport { ModelGeometryInterface } from '../core/ModelGeometryInterface';\r\nimport { CanvasEngine } from '../CanvasEngine';\r\n\r\nexport interface SimpleClientRect {\r\n\tleft: number;\r\n\tright: number;\r\n\twidth: number;\r\n\theight: number;\r\n\ttop: number;\r\n\tbottom: number;\r\n}\r\n\r\nexport class SelectionBoxState<E extends CanvasEngine = CanvasEngine> extends AbstractDisplacementState<E> {\r\n\tlayer: SelectionLayerModel;\r\n\r\n\tconstructor() {\r\n\t\tsuper({\r\n\t\t\tname: 'selection-box'\r\n\t\t});\r\n\t}\r\n\r\n\tactivated(previous: State) {\r\n\t\tsuper.activated(previous);\r\n\t\tthis.layer = new SelectionLayerModel();\r\n\t\tthis.engine.getModel().addLayer(this.layer);\r\n\t}\r\n\r\n\tdeactivated(next: State) {\r\n\t\tsuper.deactivated(next);\r\n\t\tthis.layer.remove();\r\n\t\tthis.engine.repaintCanvas();\r\n\t}\r\n\r\n\tgetBoxDimensions(event: AbstractDisplacementStateEvent): SimpleClientRect {\r\n\t\tlet rel: Point;\r\n\r\n\t\tif ('touches' in event.event) {\r\n\t\t\tconst touch = event.event.touches[0];\r\n\t\t\trel = this.engine.getRelativePoint(touch.clientX, touch.clientY);\r\n\t\t} else {\r\n\t\t\trel = this.engine.getRelativePoint(event.event.clientX, event.event.clientY);\r\n\t\t}\r\n\r\n\t\treturn {\r\n\t\t\tleft: rel.x > this.initialXRelative ? this.initialXRelative : rel.x,\r\n\t\t\ttop: rel.y > this.initialYRelative ? this.initialYRelative : rel.y,\r\n\t\t\twidth: Math.abs(rel.x - this.initialXRelative),\r\n\t\t\theight: Math.abs(rel.y - this.initialYRelative),\r\n\t\t\tright: rel.x < this.initialXRelative ? this.initialXRelative : rel.x,\r\n\t\t\tbottom: rel.y < this.initialYRelative ? this.initialYRelative : rel.y\r\n\t\t};\r\n\t}\r\n\r\n\tfireMouseMoved(event: AbstractDisplacementStateEvent) {\r\n\t\tthis.layer.setBox(this.getBoxDimensions(event));\r\n\r\n\t\tconst relative = this.engine.getRelativeMousePoint({\r\n\t\t\tclientX: this.initialX,\r\n\t\t\tclientY: this.initialY\r\n\t\t});\r\n\t\tif (event.virtualDisplacementX < 0) {\r\n\t\t\trelative.x -= Math.abs(event.virtualDisplacementX);\r\n\t\t}\r\n\t\tif (event.virtualDisplacementY < 0) {\r\n\t\t\trelative.y -= Math.abs(event.virtualDisplacementY);\r\n\t\t}\r\n\t\tconst rect = Rectangle.fromPointAndSize(\r\n\t\t\trelative,\r\n\t\t\tMath.abs(event.virtualDisplacementX),\r\n\t\t\tMath.abs(event.virtualDisplacementY)\r\n\t\t);\r\n\r\n\t\tfor (let model of this.engine.getModel().getSelectionEntities()) {\r\n\t\t\tif ((model as unknown as ModelGeometryInterface).getBoundingBox) {\r\n\t\t\t\tconst bounds = (model as unknown as ModelGeometryInterface).getBoundingBox();\r\n\t\t\t\tif (rect.containsPoint(bounds.getTopLeft()) && rect.containsPoint(bounds.getBottomRight())) {\r\n\t\t\t\t\tmodel.setSelected(true);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tmodel.setSelected(false);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.engine.repaintCanvas();\r\n\t}\r\n}\r\n"]}
{"version":3,"file":"BaseObserver.js","sourceRoot":"","sources":["../../src/core/BaseObserver.ts"],"names":[],"mappings":"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","sourcesContent":["import { Toolkit } from '../Toolkit';\r\n\r\nexport interface BaseEvent {\r\n\tfiring: boolean;\r\n\tstopPropagation: () => any;\r\n}\r\n\r\nexport interface BaseEventProxy extends BaseEvent {\r\n\tfunction: string;\r\n}\r\n\r\n/**\r\n * Listeners are always in the form of an object that contains methods that take events\r\n */\r\nexport type BaseListener = {\r\n\t/**\r\n\t * Generic event that fires before a specific event was fired\r\n\t */\r\n\teventWillFire?: (event: BaseEvent & { function: string }) => void;\r\n\r\n\t/**\r\n\t * Generic event that fires after a specific event was fired (even if it was consumed)\r\n\t */\r\n\teventDidFire?: (event: BaseEvent & { function: string }) => void;\r\n} & {\r\n\t/**\r\n\t * Type for other events that will fire\r\n\t */\r\n\t[key: string]: (event: BaseEvent) => any;\r\n};\r\n\r\nexport interface ListenerHandle {\r\n\t/**\r\n\t * Used to degister the listener\r\n\t */\r\n\tderegister: () => any;\r\n\t/**\r\n\t * Original ID of the listener\r\n\t */\r\n\tid: string;\r\n\r\n\t/**\r\n\t * Original Listener\r\n\t */\r\n\tlistener: BaseListener;\r\n}\r\n\r\n/**\r\n * Base observer pattern class for working with listeners\r\n */\r\nexport class BaseObserver<L extends BaseListener = BaseListener> {\r\n\tprotected listeners: { [id: string]: L };\r\n\r\n\tconstructor() {\r\n\t\tthis.listeners = {};\r\n\t}\r\n\r\n\tprivate fireEventInternal(fire: boolean, k: keyof L, event: BaseEvent) {\r\n\t\tthis.iterateListeners((listener) => {\r\n\t\t\t// returning false here will instruct itteration to stop\r\n\t\t\tif (!fire && !event.firing) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\t// fire selected listener\r\n\t\t\tif (listener[k]) {\r\n\t\t\t\tlistener[k](event as BaseEvent);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tfireEvent<K extends keyof L>(event: Partial<Parameters<L[K]>[0]>, k: keyof L) {\r\n\t\tevent = {\r\n\t\t\tfiring: true,\r\n\t\t\tstopPropagation: () => {\r\n\t\t\t\tevent.firing = false;\r\n\t\t\t},\r\n\t\t\t...event\r\n\t\t};\r\n\r\n\t\t// fire pre\r\n\t\tthis.fireEventInternal(true, 'eventWillFire', {\r\n\t\t\t...event,\r\n\t\t\tfunction: k\r\n\t\t} as BaseEventProxy);\r\n\r\n\t\t// fire main event\r\n\t\tthis.fireEventInternal(false, k, event as BaseEvent);\r\n\r\n\t\t// fire post\r\n\t\tthis.fireEventInternal(true, 'eventDidFire', {\r\n\t\t\t...event,\r\n\t\t\tfunction: k\r\n\t\t} as BaseEventProxy);\r\n\t}\r\n\r\n\titerateListeners(cb: (listener: L) => any) {\r\n\t\tfor (let id in this.listeners) {\r\n\t\t\tconst res = cb(this.listeners[id]);\r\n\t\t\t// cancel itteration on false\r\n\t\t\tif (res === false) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tgetListenerHandle(listener: L): ListenerHandle {\r\n\t\tfor (let id in this.listeners) {\r\n\t\t\tif (this.listeners[id] === listener) {\r\n\t\t\t\treturn {\r\n\t\t\t\t\tid: id,\r\n\t\t\t\t\tlistener: listener,\r\n\t\t\t\t\tderegister: () => {\r\n\t\t\t\t\t\tdelete this.listeners[id];\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tregisterListener(listener: L): ListenerHandle {\r\n\t\tconst id = Toolkit.UID();\r\n\t\tthis.listeners[id] = listener;\r\n\t\treturn {\r\n\t\t\tid: id,\r\n\t\t\tlistener: listener,\r\n\t\t\tderegister: () => {\r\n\t\t\t\tdelete this.listeners[id];\r\n\t\t\t}\r\n\t\t};\r\n\t}\r\n\r\n\tderegisterListener(listener: L | ListenerHandle) {\r\n\t\tif (typeof listener === 'object') {\r\n\t\t\t(listener as ListenerHandle).deregister();\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\tconst handle = this.getListenerHandle(listener);\r\n\t\tif (handle) {\r\n\t\t\thandle.deregister();\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n}\r\n"]}
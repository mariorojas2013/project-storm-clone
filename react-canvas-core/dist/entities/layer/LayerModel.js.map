{"version":3,"file":"LayerModel.js","sourceRoot":"","sources":["../../../src/entities/layer/LayerModel.ts"],"names":[],"mappings":"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","sourcesContent":["import { BaseModel, BaseModelGenerics, BaseModelOptions } from '../../core-models/BaseModel';\r\nimport { CanvasModel } from '../canvas/CanvasModel';\r\nimport _flatMap from 'lodash/flatMap';\r\nimport _forEach from 'lodash/forEach';\r\nimport _mapValues from 'lodash/mapValues';\r\nimport { CanvasEngine } from '../../CanvasEngine';\r\nimport { FactoryBank } from '../../core/FactoryBank';\r\nimport { AbstractModelFactory } from '../../core/AbstractModelFactory';\r\nimport { DeserializeEvent } from '../../core-models/BaseEntity';\r\n\r\nexport interface LayerModelOptions extends BaseModelOptions {\r\n\tisSvg?: boolean;\r\n\ttransformed?: boolean;\r\n\tisWorktable? : boolean;\r\n}\r\n\r\nexport interface LayerModelGenerics extends BaseModelGenerics {\r\n\tOPTIONS: LayerModelOptions;\r\n\tPARENT: CanvasModel;\r\n\tCHILDREN: BaseModel;\r\n\tENGINE: CanvasEngine;\r\n}\r\n\r\nexport abstract class LayerModel<G extends LayerModelGenerics = LayerModelGenerics> extends BaseModel<G> {\r\n\tprotected models: { [id: string]: G['CHILDREN'] };\r\n\tprotected repaintEnabled: boolean;\r\n\tprotected isWorktable: boolean;\r\n\r\n\tconstructor(options: G['OPTIONS'] = {}) {\r\n\t\tsuper(options);\r\n\t\tthis.models = {};\r\n\t\tthis.isWorktable = false;\r\n\t\tthis.repaintEnabled = true;\r\n\t}\r\n\r\n\t/**\r\n\t * This is used for deserialization\r\n\t */\r\n\tabstract getChildModelFactoryBank(engine: G['ENGINE']): FactoryBank<AbstractModelFactory<BaseModel>>;\r\n\r\n\tdeserialize(event: DeserializeEvent<this>) {\r\n\t\tsuper.deserialize(event);\r\n\t\tthis.options.isSvg = !!event.data.isSvg;\r\n\t\tthis.options.isWorktable = !!event.data.isWorktable;\r\n\t\tthis.options.transformed = !!event.data.transformed;\r\n\t\t_forEach(event.data.models, (model) => {\r\n\t\t\tconst modelOb = this.getChildModelFactoryBank(event.engine).getFactory(model.type).generateModel({\r\n\t\t\t\tinitialConfig: model\r\n\t\t\t});\r\n\t\t\tmodelOb.deserialize({\r\n\t\t\t\t...event,\r\n\t\t\t\tdata: model\r\n\t\t\t});\r\n\t\t\tthis.addModel(modelOb);\r\n\t\t});\r\n\t}\r\n\r\n\tserialize() {\r\n\t\treturn {\r\n\t\t\t...super.serialize(),\r\n\t\t\tisSvg: this.options.isSvg,\r\n\t\t\tisWorktable: this.options.isWorktable,\r\n\t\t\ttransformed: this.options.transformed,\r\n\t\t\tmodels: _mapValues(this.models, (model) => {\r\n\t\t\t\treturn model.serialize();\r\n\t\t\t})\r\n\t\t};\r\n\t}\r\n\r\n\tisRepaintEnabled() {\r\n\t\treturn this.repaintEnabled;\r\n\t}\r\n\r\n\tallowRepaint(allow: boolean = true) {\r\n\t\tthis.repaintEnabled = allow;\r\n\t}\r\n\r\n\tremove() {\r\n\t\tif (this.parent) {\r\n\t\t\tthis.parent.removeLayer(this);\r\n\t\t}\r\n\t\tsuper.remove();\r\n\t}\r\n\r\n\taddModel(model: G['CHILDREN']) {\r\n\t\tmodel.setParent(this);\r\n\t\tthis.models[model.getID()] = model;\r\n\t}\r\n\r\n\tgetSelectionEntities(): Array<BaseModel> {\r\n\t\treturn _flatMap(this.models, (model) => {\r\n\t\t\treturn model.getSelectionEntities();\r\n\t\t});\r\n\t}\r\n\r\n\tgetModels() {\r\n\t\treturn this.models;\r\n\t}\r\n\r\n\tgetIsWorktable(){\r\n\t\treturn this.options.isWorktable;\r\n\t}\r\n\r\n\tgetModel(id: string) {\r\n\t\treturn this.models[id];\r\n\t}\r\n\r\n\tremoveModel(id: string | G['CHILDREN']): boolean {\r\n\t\tconst _id = typeof id === 'string' ? id : id.getID();\r\n\t\tif (this.models[_id]) {\r\n\t\t\tdelete this.models[_id];\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n}\r\n"]}
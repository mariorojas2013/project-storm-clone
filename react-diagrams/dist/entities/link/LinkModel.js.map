{"version":3,"file":"LinkModel.js","sourceRoot":"","sources":["../../../src/entities/link/LinkModel.ts"],"names":[],"mappings":"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","sourcesContent":["import { PortModel } from '../port/PortModel';\r\nimport { PointModel } from './PointModel';\r\nimport _forEach from 'lodash/forEach';\r\nimport _map from 'lodash/map';\r\nimport _slice from 'lodash/slice';\r\nimport { LabelModel } from '../label/LabelModel';\r\nimport { DiagramEngine } from '../../DiagramEngine';\r\nimport { DiagramModel } from '../../models/DiagramModel';\r\nimport { boundingBoxFromPoints, Point, Rectangle } from '@projectstorm/geometry';\r\nimport {\r\n\tBaseEntityEvent,\r\n\tBaseModel,\r\n\tBaseModelGenerics,\r\n\tBaseModelListener,\r\n\tDeserializeEvent,\r\n\tModelGeometryInterface\r\n} from '@projectstorm/react-canvas-core';\r\n\r\nexport interface LinkModelListener extends BaseModelListener {\r\n\tsourcePortChanged?(event: BaseEntityEvent<LinkModel> & { port: null | PortModel }): void;\r\n\r\n\ttargetPortChanged?(event: BaseEntityEvent<LinkModel> & { port: null | PortModel }): void;\r\n}\r\n\r\nexport interface LinkModelGenerics extends BaseModelGenerics {\r\n\tLISTENER: LinkModelListener;\r\n\tPARENT: DiagramModel;\r\n}\r\n\r\nexport class LinkModel<G extends LinkModelGenerics = LinkModelGenerics>\r\n\textends BaseModel<G>\r\n\timplements ModelGeometryInterface\r\n{\r\n\tprotected sourcePort: PortModel | null;\r\n\tprotected targetPort: PortModel | null;\r\n\r\n\tprotected labels: LabelModel[];\r\n\tprotected points: PointModel[];\r\n\r\n\tprotected renderedPaths: SVGPathElement[];\r\n\r\n\tconstructor(options: G['OPTIONS']) {\r\n\t\tsuper(options);\r\n\t\tthis.points = [\r\n\t\t\tnew PointModel({\r\n\t\t\t\tlink: this\r\n\t\t\t}),\r\n\t\t\tnew PointModel({\r\n\t\t\t\tlink: this\r\n\t\t\t})\r\n\t\t];\r\n\t\tthis.sourcePort = null;\r\n\t\tthis.targetPort = null;\r\n\t\tthis.renderedPaths = [];\r\n\t\tthis.labels = [];\r\n\t}\r\n\r\n\tgetBoundingBox(): Rectangle {\r\n\t\treturn new Rectangle(\r\n\t\t\tboundingBoxFromPoints(\r\n\t\t\t\t_map(this.points, (point: PointModel) => {\r\n\t\t\t\t\treturn point.getPosition();\r\n\t\t\t\t})\r\n\t\t\t)\r\n\t\t);\r\n\t}\r\n\r\n\tgetSelectionEntities(): Array<BaseModel> {\r\n\t\tif (this.getTargetPort() && this.getSourcePort()) {\r\n\t\t\treturn super.getSelectionEntities().concat(_slice(this.points, 1, this.points.length - 1));\r\n\t\t}\r\n\t\t// allow selection of the first point\r\n\t\tif (!this.getSourcePort()) {\r\n\t\t\treturn super.getSelectionEntities().concat(_slice(this.points, 0, this.points.length - 1));\r\n\t\t}\r\n\t\t// allow selection of the last point\r\n\t\tif (!this.getTargetPort()) {\r\n\t\t\treturn super.getSelectionEntities().concat(_slice(this.points, 1, this.points.length));\r\n\t\t}\r\n\t\treturn super.getSelectionEntities().concat(this.points);\r\n\t}\r\n\r\n\tdeserialize(event: DeserializeEvent<this>) {\r\n\t\tsuper.deserialize(event);\r\n\t\tthis.points = _map(event.data.points || [], (point) => {\r\n\t\t\tvar p = new PointModel({\r\n\t\t\t\tlink: this,\r\n\t\t\t\tposition: new Point(point.x, point.y)\r\n\t\t\t});\r\n\t\t\tp.deserialize({\r\n\t\t\t\t...event,\r\n\t\t\t\tdata: point\r\n\t\t\t});\r\n\t\t\treturn p;\r\n\t\t});\r\n\r\n\t\t//deserialize labels\r\n\t\t_forEach(event.data.labels || [], (label: any) => {\r\n\t\t\tlet labelOb = (event.engine as DiagramEngine).getFactoryForLabel(label.type).generateModel({});\r\n\t\t\tlabelOb.deserialize({\r\n\t\t\t\t...event,\r\n\t\t\t\tdata: label\r\n\t\t\t});\r\n\t\t\tthis.addLabel(labelOb);\r\n\t\t});\r\n\r\n\t\t// these happen async, so we use the promises for these (they need to be done like this without the async keyword\r\n\t\t// because we need the deserailize method to finish for other methods while this happen\r\n\t\tif (event.data.target) {\r\n\t\t\tevent.getModel(event.data.targetPort).then((model: PortModel) => {\r\n\t\t\t\tthis.setTargetPort(model);\r\n\t\t\t});\r\n\t\t}\r\n\t\tif (event.data.source) {\r\n\t\t\tevent.getModel(event.data.sourcePort).then((model: PortModel) => {\r\n\t\t\t\tthis.setSourcePort(model);\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tgetRenderedPath(): SVGPathElement[] {\r\n\t\treturn this.renderedPaths;\r\n\t}\r\n\r\n\tsetRenderedPaths(paths: SVGPathElement[]) {\r\n\t\tthis.renderedPaths = paths;\r\n\t}\r\n\r\n\tserialize() {\r\n\t\treturn {\r\n\t\t\t...super.serialize(),\r\n\t\t\tsource: this.sourcePort ? this.sourcePort.getParent().getID() : null,\r\n\t\t\tsourcePort: this.sourcePort ? this.sourcePort.getID() : null,\r\n\t\t\ttarget: this.targetPort ? this.targetPort.getParent().getID() : null,\r\n\t\t\ttargetPort: this.targetPort ? this.targetPort.getID() : null,\r\n\t\t\tpoints: _map(this.points, (point) => {\r\n\t\t\t\treturn point.serialize();\r\n\t\t\t}),\r\n\t\t\tlabels: _map(this.labels, (label) => {\r\n\t\t\t\treturn label.serialize();\r\n\t\t\t})\r\n\t\t};\r\n\t}\r\n\r\n\tdoClone(lookupTable = {}, clone) {\r\n\t\tclone.setPoints(\r\n\t\t\t_map(this.getPoints(), (point: PointModel) => {\r\n\t\t\t\treturn point.clone(lookupTable);\r\n\t\t\t})\r\n\t\t);\r\n\t\tif (this.sourcePort) {\r\n\t\t\tclone.setSourcePort(this.sourcePort.clone(lookupTable));\r\n\t\t}\r\n\t\tif (this.targetPort) {\r\n\t\t\tclone.setTargetPort(this.targetPort.clone(lookupTable));\r\n\t\t}\r\n\t}\r\n\r\n\tclearPort(port: PortModel) {\r\n\t\tif (this.sourcePort === port) {\r\n\t\t\tthis.setSourcePort(null);\r\n\t\t} else if (this.targetPort === port) {\r\n\t\t\tthis.setTargetPort(null);\r\n\t\t}\r\n\t}\r\n\r\n\tremove() {\r\n\t\tif (this.sourcePort) {\r\n\t\t\tthis.sourcePort.removeLink(this);\r\n\t\t\tdelete this.sourcePort;\r\n\t\t}\r\n\t\tif (this.targetPort) {\r\n\t\t\tthis.targetPort.removeLink(this);\r\n\t\t\tdelete this.targetPort;\r\n\t\t}\r\n\t\tsuper.remove();\r\n\t}\r\n\r\n\tisLastPoint(point: PointModel) {\r\n\t\tvar index = this.getPointIndex(point);\r\n\t\treturn index === this.points.length - 1;\r\n\t}\r\n\r\n\tgetPointIndex(point: PointModel) {\r\n\t\treturn this.points.indexOf(point);\r\n\t}\r\n\r\n\tgetPointModel(id: string): PointModel | null {\r\n\t\tfor (var i = 0; i < this.points.length; i++) {\r\n\t\t\tif (this.points[i].getID() === id) {\r\n\t\t\t\treturn this.points[i];\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\tgetPortForPoint(point: PointModel): PortModel {\r\n\t\tif (this.sourcePort !== null && this.getFirstPoint().getID() === point.getID()) {\r\n\t\t\treturn this.sourcePort;\r\n\t\t}\r\n\t\tif (this.targetPort !== null && this.getLastPoint().getID() === point.getID()) {\r\n\t\t\treturn this.targetPort;\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\tgetPointForPort(port: PortModel): PointModel {\r\n\t\tif (this.sourcePort !== null && this.sourcePort.getID() === port.getID()) {\r\n\t\t\treturn this.getFirstPoint();\r\n\t\t}\r\n\t\tif (this.targetPort !== null && this.targetPort.getID() === port.getID()) {\r\n\t\t\treturn this.getLastPoint();\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\tgetFirstPoint(): PointModel {\r\n\t\treturn this.points[0];\r\n\t}\r\n\r\n\tgetLastPoint(): PointModel {\r\n\t\treturn this.points[this.points.length - 1];\r\n\t}\r\n\r\n\tsetSourcePort(port: PortModel | null) {\r\n\t\tif (port !== null) {\r\n\t\t\tport.addLink(this);\r\n\t\t}\r\n\t\tif (this.sourcePort !== null) {\r\n\t\t\tthis.sourcePort.removeLink(this);\r\n\t\t}\r\n\t\tthis.sourcePort = port;\r\n\t\tthis.fireEvent({ port }, 'sourcePortChanged');\r\n\t\tif (port?.reportedPosition) {\r\n\t\t\tthis.getPointForPort(port).setPosition(port.getCenter());\r\n\t\t}\r\n\t}\r\n\r\n\tgetSourcePort(): PortModel {\r\n\t\treturn this.sourcePort;\r\n\t}\r\n\r\n\tgetTargetPort(): PortModel {\r\n\t\treturn this.targetPort;\r\n\t}\r\n\r\n\tsetTargetPort(port: PortModel | null) {\r\n\t\tif (port !== null) {\r\n\t\t\tport.addLink(this);\r\n\t\t}\r\n\t\tif (this.targetPort !== null) {\r\n\t\t\tthis.targetPort.removeLink(this);\r\n\t\t}\r\n\t\tthis.targetPort = port;\r\n\t\tthis.fireEvent({ port }, 'targetPortChanged');\r\n\t\tif (port?.reportedPosition) {\r\n\t\t\tthis.getPointForPort(port).setPosition(port.getCenter());\r\n\t\t}\r\n\t}\r\n\r\n\tpoint(x: number, y: number, index: number = 1): PointModel {\r\n\t\treturn this.addPoint(this.generatePoint(x, y), index);\r\n\t}\r\n\r\n\taddLabel(label: LabelModel) {\r\n\t\tlabel.setParent(this);\r\n\t\tthis.labels.push(label);\r\n\t}\r\n\r\n\tgetPoints(): PointModel[] {\r\n\t\treturn this.points;\r\n\t}\r\n\r\n\tgetLabels() {\r\n\t\treturn this.labels;\r\n\t}\r\n\r\n\tsetPoints(points: PointModel[]) {\r\n\t\t_forEach(points, (point) => {\r\n\t\t\tpoint.setParent(this);\r\n\t\t});\r\n\t\tthis.points = points;\r\n\t}\r\n\r\n\tremovePoint(pointModel: PointModel) {\r\n\t\tif (this.isLastPoint(pointModel)) this.remove();\r\n\t\tthis.points.splice(this.getPointIndex(pointModel), 1);\r\n\t}\r\n\r\n\tremovePointsBefore(pointModel: PointModel) {\r\n\t\tthis.points.splice(0, this.getPointIndex(pointModel));\r\n\t}\r\n\r\n\tremovePointsAfter(pointModel: PointModel) {\r\n\t\tthis.points.splice(this.getPointIndex(pointModel) + 1);\r\n\t}\r\n\r\n\tremoveMiddlePoints() {\r\n\t\tif (this.points.length > 2) {\r\n\t\t\tthis.points.splice(1, this.points.length - 2);\r\n\t\t}\r\n\t}\r\n\r\n\taddPoint<P extends PointModel>(pointModel: P, index = 1): P {\r\n\t\tpointModel.setParent(this);\r\n\t\tthis.points.splice(index, 0, pointModel);\r\n\t\treturn pointModel;\r\n\t}\r\n\r\n\tgeneratePoint(x: number = 0, y: number = 0): PointModel {\r\n\t\treturn new PointModel({\r\n\t\t\tlink: this,\r\n\t\t\tposition: new Point(x, y)\r\n\t\t});\r\n\t}\r\n}\r\n"]}